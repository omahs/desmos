<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-architecture/adr-017-subspace-fee-grant">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">ADR 017: Subspace fee grant | Desmos documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://test-docs.desmos.network/architecture/adr-017-subspace-fee-grant"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="ADR 017: Subspace fee grant | Desmos documentation"><meta data-rh="true" name="description" content="Changelog"><meta data-rh="true" property="og:description" content="Changelog"><link data-rh="true" rel="icon" href="/assets/favicon.ico"><link data-rh="true" rel="canonical" href="https://test-docs.desmos.network/architecture/adr-017-subspace-fee-grant"><link data-rh="true" rel="alternate" href="https://test-docs.desmos.network/architecture/adr-017-subspace-fee-grant" hreflang="en"><link data-rh="true" rel="alternate" href="https://test-docs.desmos.network/architecture/adr-017-subspace-fee-grant" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://1IAGPKAXGP-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Desmos documentation" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.fcc6b822.css">
<link rel="preload" href="/assets/js/runtime~main.0e2de217.js" as="script">
<link rel="preload" href="/assets/js/main.f783f73f.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?e("light"):e("dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://docs.desmos.network" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/assets/logo.svg" alt="Desmos logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/assets/logo.svg" alt="Desmos logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Documentation</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/">master</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/architecture/adr-017-subspace-fee-grant">master</a></li><li><a class="dropdown__link" href="/4.2.0/">4.2.0</a></li><li><a class="dropdown__link" href="/2.3/">2.3</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/developers/overview">Developers</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/fullnode/overview">Running a Fullnode</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/validators/overview">Validators</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/testnet/overview">Testnet</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/mainnet/genesis-file">Mainnet</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/architecture/">ADRs</a><button aria-label="Toggle the collapsible sidebar category &#x27;ADRs&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/architecture/PROCESS">ADR Creation Process</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/architecture/adr-001-change-chain-links-plain-text-encoding-to-hex">ADR 001: Change chain link plain text encoding to hex</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/architecture/adr-002-mutual-dtags-exchange">ADR 002: Mutual DTags exchange</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/architecture/adr-003-remove-custom-json-tags-from-profo-files">ADR 003: Remove custom JSON tags from Proto files</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/architecture/adr-004-application-links-expiration">ADR 004: Expiration of application links</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/architecture/adr-005-support-multisig-chain-link">ADR 006: Support multisig chain link</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/architecture/adr-006-subspace-module">ADR 006: Subspace module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/architecture/adr-007-address-generation-of-chain-link-proof">ADR 007: Address generation of chain link proof</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/architecture/adr-008-fee-module">ADR 008: Fees modules</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/architecture/adr-009-supply-module">ADR 009: Supply module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/architecture/adr-010-posts-module">ADR 010: Posts module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/architecture/adr-011-reports-module">ADR 011: Reports module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/architecture/adr-012-subspaces-sections">ADR 012: Subspaces sections</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/architecture/adr-013-per-chain-default-address">ADR 013: Per-chain default external address</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/architecture/adr-014-improve-permissions">ADR 014: Improve the permission system</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/architecture/adr-015-improve-chain-link-signature-support">ADR 015: Improve chain links signature support</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/architecture/adr-016-reactions-module">ADR 016: Reactions module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/architecture/adr-017-subspace-fee-grant">ADR 017: Subspace fee grant</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/architecture/adr-018-improve-subspace-treasury-account">ADR 018: Improve subspace treasury account</a></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/architecture/"><span itemprop="name">ADRs</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">ADR 017: Subspace fee grant</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: master</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>ADR 017: Subspace fee grant</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="changelog">Changelog<a class="hash-link" href="#changelog" title="Direct link to heading">​</a></h2><ul><li>Nov 14th, 2022: First draft;</li><li>Nov 21th, 2022: First review.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="status">Status<a class="hash-link" href="#status" title="Direct link to heading">​</a></h2><p>ACCEPTED Not Implemented</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="abstract">Abstract<a class="hash-link" href="#abstract" title="Direct link to heading">​</a></h2><p>This ADR introduces a new subspace-based fee grant method, which allows subspace owners/admins to pay the fees of subspace-related transactions on behalf of the users.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="context">Context<a class="hash-link" href="#context" title="Direct link to heading">​</a></h2><p>One of the major problems of current Web3-based applications that make them complicated to use by common people is the fact that they require users to have some tokens in order to pay transaction fees to perform various operations. For instance, in order to create a post on any Desmos-based social network, users have to:</p><ol><li>understand what a <em>transaction</em> is and why they need some DSM to broadcast it;</li><li>get some DSM either via an on-ramp service or by swapping existing funds.</li></ol><p>The <code>x/feegrant</code> module of the Cosmos SDK allows anyone to pay fees on behalf of other users, meaning that the latter can ideally perform any kind of transaction without even knowing the concept of fees. However, the <code>x/feegrant</code> allowance is not subspace-specific: this means that subspace admins/owners might unexpectingly pay the fees for transactions that are related to other subspaces.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="decision">Decision<a class="hash-link" href="#decision" title="Direct link to heading">​</a></h2><p>We will implement a subspace-specific fee grant process, based on  the <code>x/feegrant</code> module, that allows subspace fees providers to pay fees for the users inside the specified subspace. This system will allow subspace owners/admins to issue a fee grant towards either a users group or a single user, so that they can later leverage this grant to execute subspace-related transactions without having to worry about paying fees.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="deductfeedecorator">DeductFeeDecorator<a class="hash-link" href="#deductfeedecorator" title="Direct link to heading">​</a></h3><p>Currently, the <code>x/auth</code> module provides a <code>DeductFeeDecorator</code> that deducts the fees of a transaction from the signer/feepayer. We will build a new subspace-specific <code>DeductFeeDecorator</code> based on the existing one that acts as follows:</p><ol><li>check if all the messages in the transaction are messages related to the same subspace;</li><li>perform the following operation:<ol><li>if all the messages are all related to the same subspace and a fee grant exists for the fee payer inside the subspace, run the <code>x/subspaces</code> <code>DeductFeeDecorator</code></li><li>otherwise, run the <code>x/auth</code> <code>DeductFeeDecorator</code></li></ol></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="types">Types<a class="hash-link" href="#types" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="allowance">Allowance<a class="hash-link" href="#allowance" title="Direct link to heading">​</a></h4><p>The <code>x/feegrant</code> module already provides an interface (<code>FeeAllowanceI</code>) to represent a generic allowance, along with a set of useful implementations like <code>BasicAllowance</code>, <code>AllowedMsgAllowance</code> and <code>PeriodicAllowance</code>. Since we are not going to introduce new kinds of allowances, nor we are going to edit how an allowance is represented, we will reuse these types.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="user-grant">User Grant<a class="hash-link" href="#user-grant" title="Direct link to heading">​</a></h4><p>The <code>x/feegrant</code> module provides a <code>Grant</code> object used to store the <code>granter</code>, <code>grantee</code> and what kind of <code>allowance</code> is granted to a specific user. Since this is enough information for us as well, we will use the same object to store user-related fee grants.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="group-grant">Group Grant<a class="hash-link" href="#group-grant" title="Direct link to heading">​</a></h4><p>In order to represent a fee grant granted to a user group, we will implement a <code>GroupGrant</code> type. This will contain the <code>granter</code>, <code>group_id</code> and what kind of <code>allowance</code> is granted to the group:</p><div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">message GroupGrant {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // granter is the address of the user granting an allowance of their funds.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  string granter = 1 [(cosmos_proto.scalar) = &quot;cosmos.AddressString&quot;];</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // the id of the group being granted an allowance of another user&#x27;s funds.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  uint32 group_id = 2;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // allowance can be any of basic, periodic, allowed fee allowance.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  google.protobuf.Any allowance = 3 [(cosmos_proto.accepts_interface) = &quot;FeeAllowanceI&quot;];</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="store">Store<a class="hash-link" href="#store" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="group-grant-1">Group grant<a class="hash-link" href="#group-grant-1" title="Direct link to heading">​</a></h4><p>In order to simplify the management of group allowances, each granted group allowance will be stored using the following key:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">SubspaceGroupAllowancePrefix | SubspaceID | GranterAddress | GroupID | -&gt; Protobuf(GroupGrant)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This structure allows granters to easily manage the group allowance inside a subspace by iterating over all allowances for the granters, which will be the most used query. On the other hand, it allows to perform the following queries: </p><ol><li>finding a specific grant given the granter address.<br>This can be done in O(N), where N is the number of granted groups by the granter.</li><li>finding all the grants given to a user based on the groups they are part of.
This can be done in O(N * log(M)), where N is the number of all the grants inside the subspace, and M is the number of members in the user group.</li></ol><p>Considering that: </p><ul><li>only users with permissions will be able to create grants in each subspace</li><li>there will be a small number of grants each granter will create</li></ul><p>then the time complexity of searching if a user has been granted a fee grant should not become too large.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="user-grant-1">User grant<a class="hash-link" href="#user-grant-1" title="Direct link to heading">​</a></h4><p>Each subspace fee granted allowance will be stored using keys with the following structure:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">SubspaceUserAllowancePrefix | SubspaceID | GranterAddress | GranteeAddress |-&gt; Protobuf(Grant)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This structure allows granters to easily manage their grants inside a subspace by iterating over all grants for the granters, which will be the most used query. On the other hand, it allows the following queries:</p><ol><li>retrieving a specific grant.<br>This will require grantees to know who the granter address, and can be done in O(1).</li><li>retrieving all the grants that a user has been granted.
This can be done by iterating over all the granters&#x27; grants in O(N), where N is the number of all the grants inside the given subspace.</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="expired-allowance">Expired Allowance<a class="hash-link" href="#expired-allowance" title="Direct link to heading">​</a></h3><p>The subspace owners may want to set the allowance to expire after a certain amount of time. In order to reduce the database size, we will use a custom <code>BeginBlocker</code> to remove all expired allowances.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="store-1">Store<a class="hash-link" href="#store-1" title="Direct link to heading">​</a></h4><p>In order to make it easier to remove expired allowances, we will implement queues sorted by expiration time. Then, during the <code>BeginBlock</code> phase, we iterate over all expired keys before the block time and remove them. The structure of the queues keys will be the following:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">ExpiringAllowanceQueuePrefix | Expired Time | Subspace ID | Granter Address | (User Address or Group ID) -&gt; 0x01</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="msg-service"><code>Msg</code> Service<a class="hash-link" href="#msg-service" title="Direct link to heading">​</a></h3><p>In order to allow subspace fees providers to grant an allowance for the users, we will have the following operations:</p><ul><li>grant an allowance to a user</li><li>revoke an allowance to a user</li><li>grant an allowance to a group</li><li>revoke an allowance to a group</li></ul><div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">service Msg {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // GrantUserAllowance allows the granter to grant a fee allowance to the grantee.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    rpc GrantUserAllowance(MsgGrantUserAllowance) returns(MsgGrantUserAllowanceResponse);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // RevokeUserAllowance allows a granter to revoke any existing allowance that has to been granted to the grantee.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    rpc RevokeUserAllowance(MsgRevokeUserAllowance) returns(MsgRevokeUserAllowanceResponse);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // GrantGroupAllowance allows the granter to grant a fee allowance to the group.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    rpc GrantGroupAllowance(MsgGrantGroupAllowance) returns(MsgGrantGroupAllowanceResponse);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // RevokeGroupAllowance allows a granter to revoke any existing allowance that has to been granted to the group.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    rpc RevokeGroupAllowance(MsgRevokeGroupAllowance) returns(MsgRevokeGroupAllowanceResponse);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// MsgGrantUserAllowance adds permissions for the grantee to spend up allowance of fees from the granter inside the given subspace.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">message MsgGrantUserAllowance {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // the id of the subspace where the granter grants the allowance to the grantee.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    uint64 subspace_id = 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // the address of the user granting an allowance of their funds.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    string granter = 2;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // the address of the user being granted an allowance of another user&#x27;s funds.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    string grantee = 3;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // allowance can be any of fee allowances which implements FeeAllowanceI.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    google.protobuf.Any allowance = 4 [(cosmos_proto.accepts_interface) = &quot;FeeAllowanceI&quot;];</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// MsgGrantUserAllowanceResponse defines the Msg/GrantAllowanceResponse response type.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">message MsgGrantUserAllowanceResponse {}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// MsgRevokeUserAllowance removes any existing allowance from granter to the grantee inside the subspace.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">message MsgRevokeUserAllowance {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // the id of the subspace where the granter grants the allowance to the grantee.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    uint64 subspace_id = 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // the address of the user granting an allowance of their funds.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    string granter = 2;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // the address of the user being granted an allowance of another user&#x27;s funds.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    string grantee = 3;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// MsgRevokeUserAllowanceResponse defines the Msg/RevokeAllowanceResponse response type.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">message MsgRevokeUserAllowanceResponse {}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// MsgGrantGroupAllowance adds permissions for the group to spend up allowance of fees from the granter inside the given subspace.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">message MsgGrantGroupAllowance {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // the id of the subspace where the granter grants the allowance to the grantee.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    uint64 subspace_id = 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // the id of the group being granted an allowance of another user&#x27;s funds.  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    uint32 group_id = 2;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // the address of the user granting an allowance of their funds.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    string granter = 3;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // allowance can be any of fee allowances which implements FeeAllowanceI.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    google.protobuf.Any allowance = 4 [(cosmos_proto.accepts_interface) = &quot;FeeAllowanceI&quot;];</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// MsgGrantGroupAllowanceResponse defines the Msg/GrantAllowanceResponse response type.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">message MsgGrantGroupAllowanceResponse {}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// MsgRevokeGroupAllowance removes any existing allowance from granter to the group inside the subspace.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">message MsgRevokeGroupAllowance {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // the id of the subspace where the granter grants the allowance to the group.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    uint64 subspace_id = 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // the id of the group being granted an allowance of another user&#x27;s funds.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    uint32 group_id = 2;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // the address of the user granting an allowance of their funds.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    string granter = 3;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// MsgRevokeGroupAllowanceResponse defines the Msg/RevokeAllowanceResponse response type.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">message MsgRevokeUserAllowanceResponse {}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="query-service"><code>Query</code> Service<a class="hash-link" href="#query-service" title="Direct link to heading">​</a></h3><p>In order to allow clients to easily query for allowances we will implement the following new queries:</p><div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">service Query {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // UserAllowances returns all the grants for users.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    rpc UserAllowances(QueryUserAllowancesRequest) returns (QueryAllowancesResponse) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        option (google.api.http).get = &quot;/desmos/subspaces/v3/subspaces/{subspace_id}/allowances/users&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // GroupAllowances returns all the grants for groups.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    rpc GroupAllowances(QueryGroupAllowancesRequest) returns(QueryGroupAllowancesResponse) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        option (google.api.http).get = &quot;/desmos/subspaces/v3/subspaces/{subspace_id}/allowances/groups&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// QueryUserAllowancesRequest is the request type for the Query/UserAllowances RPC method.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">message QueryUserAllowancesRequest {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // the id of the subspace where the granter grants the allowance to the grantee.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    uint64 subspace_id = 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // (optional) the address of the user granting an allowance of their funds.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    string granter = 2;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // (Optional) the address of the user being granted an allowance of another user&#x27;s funds.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    string grantee = 3;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // pagination defines an pagination for the request.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    cosmos.base.query.v1beta1.PageRequest pagination = 4;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// QueryUserAllowancesResponse is the response type for the Query/UserAllowances RPC method.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">message QueryUserAllowancesResponse {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // allowances are allowance&#x27;s granted for grantee by granter.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    repeated cosmos.feegrant.v1beta1.Grant allowances = 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // pagination defines an pagination for the response.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    cosmos.base.query.v1beta1.PageResponse pagination = 2;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// QueryGroupAllowancesRequest is the request type for the Query/GroupAllowances RPC method.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">message QueryGroupAllowancesRequest {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // the id of the subspace where the granter grants the allowance to the grantee.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    uint64 subspace_id = 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // (optional) the address of the user granting an allowance of their funds.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    string granter = 2;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // (Optional) the id of the group being granted an allowance of another user&#x27;s funds.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    uint32 group_id = 3;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // pagination defines an pagination for the request.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    cosmos.base.query.v1beta1.PageRequest pagination = 4;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// QueryGroupAllowancesResponse is the response type for the Query/GroupAllowances RPC method.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">message QueryGroupAllowancesResponse {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // allowances are allowance&#x27;s granted for grantee by granter.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    repeated cosmos.subspace.v3.GroupGrant allowances = 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // pagination defines an pagination for the response.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    cosmos.base.query.v1beta1.PageResponse pagination = 2;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="consequences">Consequences<a class="hash-link" href="#consequences" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="backwards-compatibility">Backwards Compatibility<a class="hash-link" href="#backwards-compatibility" title="Direct link to heading">​</a></h3><p>The proposed solution introduces a new set of store keys, thus it is completely backward compatible.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="positive">Positive<a class="hash-link" href="#positive" title="Direct link to heading">​</a></h3><ul><li>Allow subspace fee providers to grant fees allowances to their users.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="negative">Negative<a class="hash-link" href="#negative" title="Direct link to heading">​</a></h3><ul><li>Storing extra subspace grant info takes up more storage space;</li><li>Having more checks during the fee deduction phase slows down the transaction processing operation;</li><li>Removing expired allowances at the block begin phase increases the block production time.  </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="neutral">Neutral<a class="hash-link" href="#neutral" title="Direct link to heading">​</a></h3><ul><li>Not known</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a class="hash-link" href="#references" title="Direct link to heading">​</a></h2><ul><li><a href="https://docs.cosmos.network/v0.46/modules/feegrant/01_concepts.html" target="_blank" rel="noopener noreferrer">Cosmos SDK fee grant concepts</a></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/desmos-labs/desmos/tree/master/docs/docs/architecture/adr-017-subspace-fee-grant.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/architecture/adr-016-reactions-module"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">ADR 016: Reactions module</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/architecture/adr-018-improve-subspace-treasury-account"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">ADR 018: Improve subspace treasury account</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#changelog" class="table-of-contents__link toc-highlight">Changelog</a></li><li><a href="#status" class="table-of-contents__link toc-highlight">Status</a></li><li><a href="#abstract" class="table-of-contents__link toc-highlight">Abstract</a></li><li><a href="#context" class="table-of-contents__link toc-highlight">Context</a></li><li><a href="#decision" class="table-of-contents__link toc-highlight">Decision</a><ul><li><a href="#deductfeedecorator" class="table-of-contents__link toc-highlight">DeductFeeDecorator</a></li><li><a href="#types" class="table-of-contents__link toc-highlight">Types</a></li><li><a href="#store" class="table-of-contents__link toc-highlight">Store</a></li><li><a href="#expired-allowance" class="table-of-contents__link toc-highlight">Expired Allowance</a></li><li><a href="#msg-service" class="table-of-contents__link toc-highlight"><code>Msg</code> Service</a></li><li><a href="#query-service" class="table-of-contents__link toc-highlight"><code>Query</code> Service</a></li></ul></li><li><a href="#consequences" class="table-of-contents__link toc-highlight">Consequences</a><ul><li><a href="#backwards-compatibility" class="table-of-contents__link toc-highlight">Backwards Compatibility</a></li><li><a href="#positive" class="table-of-contents__link toc-highlight">Positive</a></li><li><a href="#negative" class="table-of-contents__link toc-highlight">Negative</a></li><li><a href="#neutral" class="table-of-contents__link toc-highlight">Neutral</a></li></ul></li><li><a href="#references" class="table-of-contents__link toc-highlight">References</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Related docs</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://docs.cosmos.network" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cosmos SDK<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docs.cosmwasm.com/en/docs/1.0/" target="_blank" rel="noopener noreferrer" class="footer__link-item">CosmWasm<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/DesmosNetwork" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.desmos.network/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://medium.com/desmosnetwork" target="_blank" rel="noopener noreferrer" class="footer__link-item">Medium<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://t.me/desmosnetwork" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.reddit.com/r/DesmosNetwork/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Reddit (not-official)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.desmos.network" target="_blank" rel="noopener noreferrer" class="footer__link-item">Website</a></li><li class="footer__item"><a href="https://github.com/desmos-labs/desmos" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://www.desmos.network" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/assets/logo.png" alt="Desmos Logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/assets/logo.png" alt="Desmos Logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></a></div><div class="footer__copyright">Copyright © 2023 Desmos Network</div></div></div></footer></div>
<script src="/assets/js/runtime~main.0e2de217.js"></script>
<script src="/assets/js/main.f783f73f.js"></script>
</body>
</html>